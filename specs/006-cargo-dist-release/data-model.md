# Data Model: Cross-Platform Binary Distribution & Self-Update

**Feature**: 006-cargo-dist-release
**Date**: 2026-02-12

## Entities

This feature introduces no persistent data structures in the application code. The key "data" artifacts are configuration files and CI-generated outputs.

### Install Receipt (external, written by cargo-dist installer)

Not owned by dbtoon code, but consumed by the `update` subcommand via axoupdater.

| Field | Type | Description |
|-------|------|-------------|
| `install_prefix` | string | Path where binary was installed (e.g., `~/.cargo`) |
| `binaries` | string[] | List of installed binary names (`["dbtoon"]`) |
| `source.release_type` | string | Always `"github"` for this project |
| `source.owner` | string | GitHub org/user (`"jesse-smith"`) |
| `source.name` | string | Repository name (`"dbtoon"`) |
| `source.app_name` | string | Application name (`"dbtoon"`) |
| `version` | string | Installed version (`"0.2.0"`) |
| `provider.source` | string | Build tool (`"cargo-dist"`) |
| `provider.version` | string | cargo-dist version used to build |

Location: `~/.config/dbtoon/dbtoon-receipt.json` (Linux/macOS), `%LOCALAPPDATA%\dbtoon\dbtoon-receipt.json` (Windows)

### CLI Command Enum Extension

The existing `Command` enum in `src/cli.rs` gains one variant:

```rust
#[derive(Subcommand, Debug)]
pub enum Command {
    ExecRead(ExecArgs),
    ExecWrite(ExecArgs),
    ListWarehouses(ListWarehousesArgs),
    Update,  // new
}
```

No additional struct needed — `update` takes no arguments.

### Configuration Files (new, project-level)

| File | Purpose | Owned by |
|------|---------|----------|
| `dist-workspace.toml` | cargo-dist configuration (targets, installers, CI settings) | cargo-dist (regenerated by `cargo dist generate`) |
| `.github/workflows/release.yml` | Release CI workflow | cargo-dist (regenerated by `cargo dist generate`) |

### Build Profile (added to Cargo.toml)

```toml
[profile.dist]
inherits = "release"
lto = "thin"
```

## State Transitions

The `update` subcommand has a simple linear flow with three terminal states:

```
Start
  │
  ├─ No receipt found ──────────────► "Installed via cargo install" message (exit 0)
  │
  ├─ Receipt exists, exe mismatch ──► "Wrong install method" message (exit 0)
  │
  └─ Receipt valid
       │
       ├─ Network error ────────────► "Cannot check for updates" error (exit 1)
       │
       ├─ Already up to date ───────► "Already up to date" message (exit 0)
       │
       └─ Newer version available
            │
            ├─ Install succeeded ───► "Updated to vX.Y.Z" message (exit 0)
            │
            └─ Install failed ──────► Error details (exit 1)
```

## Relationships

```
dist-workspace.toml ──configures──► .github/workflows/release.yml
                                         │
                                    builds + publishes
                                         │
                                         ▼
                                    GitHub Release
                                    ├── dbtoon-x86_64-pc-windows-msvc.zip
                                    ├── dbtoon-x86_64-unknown-linux-gnu.tar.gz
                                    ├── dbtoon-aarch64-apple-darwin.tar.gz
                                    ├── dbtoon-x86_64-apple-darwin.tar.gz
                                    ├── dbtoon-installer.sh
                                    └── dbtoon-installer.ps1
                                         │
                                    installer writes
                                         │
                                         ▼
                                    Install Receipt JSON
                                         │
                                    read by axoupdater
                                         │
                                         ▼
                                    `dbtoon update` subcommand
```
